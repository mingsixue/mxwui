import{COLOR,hexToRGBA}from"../utils/common";Component({properties:{visible:{type:Boolean,value:!1,observer(e){e&&this.init()}},value:{type:String,value:""},minuteStep:{type:Number,value:1},showYear:{type:Boolean,value:!0},showHour:{type:Boolean,value:!0},showMinute:{type:Boolean,value:!0},showSeconds:{type:Boolean,value:!1},yearSuffix:{type:String,value:"年"},monthSuffix:{type:String,value:"月"},daySuffix:{type:String,value:"日"},hourSuffix:{type:String,value:"时"},minuteSuffix:{type:String,value:"分"},secondsSuffix:{type:String,value:"秒"},minYearLimit:{type:Number,value:1970},maxYearLimit:{type:Number,value:""},title:{type:String,value:""},cancelText:{type:String,value:"取消"},cancelColor:{type:String,value:COLOR.PLACEHOLDER_COLOR},confirmText:{type:String,value:"确定"},confirmColor:{type:String,value:COLOR.THEME_COLOR},zIndex:{type:Number,value:1},isCloseMask:{type:Boolean,value:!0}},ready(){var e;this.data.bgColor||(e=hexToRGBA(COLOR.THEME_COLOR,.15),this.setData({bgColor:e})),this.MONTH=12,this.HOUR=24,this.MINUTE=60,this.SECONDS=60},methods:{init(){var{showYear:e,showHour:t,showMinute:a,showSeconds:r,minYearLimit:n,maxYearLimit:s,value:i,min:o,max:u}=this.data,i=this.dealDate(i,"init now"),n=n||1970,s=s||i.year+20;let h=[],l=0,d=(e&&(n=this.dealYear(i,n,s),h=n.list,l=n.currentYearIndex),[]),m=0,p=[],v=0,x=[],c=0,y=[],f=0,g=[],S=0,I=(o&&u||o||u||(d=this.dealMonth("normal",{now:i,now:i})||[],m=this.dealIdx(d,i.month),p=this.dealDay("normal",{year:i.year,month:i.monthStr,now:i})||[],v=this.dealIdx(p,i.day,"day"),t&&(x=this.dealHour("normal")||[],c=this.dealIdx(x,i.hour)),a&&(y=this.dealMinute("normal")||[],f=this.dealIdx(y,i.minute)),r&&(g=this.dealSeconds("normal")||[],S=this.dealIdx(g,i.seconds))),[]);e&&I.push(l),I.push(m),I.push(v),t&&I.push(c),t&&a&&I.push(f),t&&a&&r&&I.push(S),this.setData({years:h,months:d,days:p,hours:x,minutes:y,seconds:g,currentYearIndex:l,currentMonthIndex:m,currentDayIndex:v,currentHourIndex:c,currentMinuteIndex:f,currentSecondsIndex:S},()=>{setTimeout(()=>{this.setData({currentIndex:I})},100)})},changeIdx(t){var t=t.detail.value,{showYear:e,showHour:a,showMinute:r,showSeconds:n,years:s=[],min:i,max:o}=this.data,{months:u=[],days:h=[],hours:l=[],minutes:d=[],currentYearIndex:m,currentMonthIndex:p}=this.data;let v=0,x=0,c=0,y=0,f=0,g=0;6==t.length?(v=t[0],x=t[1],c=t[2],y=t[3],f=t[4],g=t[5]):5==t.length?e?(v=t[0],x=t[1],c=t[2],y=t[3],f=t[4]):n&&(x=t[0],c=t[1],y=t[2],f=t[3],g=t[4]):4==t.length?(x=t[0],c=t[1],y=t[2],f=t[3]):2==t.length?(x=t[0],c=t[1]):3==t.length&&e?(v=t[0],x=t[1],c=t[2]):3==t.length&&a&&(x=t[0],c=t[1],y=t[2]);s[v],u[x],h[c],l[y];if(!(i&&o||i||o||m==v&&p==x)){let e=s[v];e||(t=new Date,e=t.getFullYear());i=this.dealDay("normal",{year:e,month:u[x]});this.setData({days:i}),c>i.length&&(c=0)}o=[];e&&o.push(v),o.push(x),o.push(c),a&&o.push(y),r&&o.push(f),n&&o.push(g),this.setData({months:u,days:h,hours:l,minutes:d,currentIndex:o,currentYearIndex:v,currentMonthIndex:x,currentDayIndex:c,currentHourIndex:y,currentMinuteIndex:f,currentSecondsIndex:g},()=>{})},dealDate(e,t){var{showYear:a,showHour:r,showMinute:n,showSeconds:s}=this.data;let i=new Date;e&&(a||(e=i.getFullYear()+"-"+e),r||(e+=" 00"),n||(e+=":00"),s&&(e+=":00"),e=e.replace(/-/g,"/"),i=new Date(e));a=i.getFullYear(),r=i.getMonth(),n=new Date(a,r+1,0).getDate();return{year:a,month:r,monthStr:r+1,day:i.getDate(),hour:i.getHours(),minute:i.getMinutes(),seconds:i.getSeconds(),dayLimit:n}},dealYear(t,a,e){var r=this.data.showYear,n=[];let s=0;if(r){var i=e-a+1;for(let e=0;e<i;e++){var o=e+a;n.push(o),t.year==o&&(s=e)}}return{list:n,currentYearIndex:s}},dealMonth(e,t={}){var a=[];if("min"==e)for(let e=t.min.month;e<this.MONTH;e++){var r=e+1;a.push(r)}else if("max"==e)for(let e=0;e<=t.max.month;e++){var n=e+1;a.push(n)}else if("limit"==e)for(let e=t.min.month;e<t.max.month;e++){var s=e+1;a.push(s)}else for(let e=0;e<this.MONTH;e++){var i=e+1;a.push(i)}return a},dealDay(e,t={}){var a=[];if("min"==e)for(let e=t.min.day;e<t.min.dayLimit;e++){var r=e;a.push(r)}else if("max"==e)for(let e=0;e<=t.max.day;e++){var n=e;a.push(n)}else if("limit"==e)for(let e=t.min.day;e<=t.max.day;e++){var s=e;a.push(s)}else{var i=new Date(t.year,t.month,0).getDate();for(let e=0;e<i;e++){var o=e+1;a.push(o)}}return a},dealHour(e,t={}){var a=[];if("min"==e)for(let e=t.min.hour;e<this.HOUR;e++){var r=e;a.push(r)}else if("max"==e)for(let e=0;e<=t.max.hour;e++){var n=e;a.push(n)}else if("limit"==e)for(let e=t.min.hour;e<=t.max.hour;e++){var s=e;a.push(s)}else for(let e=0;e<this.HOUR;e++){var i=e;a.push(i)}return a},dealMinute(e,t={}){var a=this.data.minuteStep,r=[];if("min"==e)for(let e=t.min.minute;e<this.MINUTE;e+=a){var n=e;r.push(n)}else if("max"==e)for(let e=0;e<=t.max.minute;e+=a){var s=e;r.push(s)}else if("limit"==e)for(let e=t.min.minute;e<=t.max.minute;e+=a){var i=e;r.push(i)}else for(let e=0;e<this.MINUTE;e+=a){var o=e;r.push(o)}return r},dealSeconds(e,t={}){var a=[];if("min"==e)for(let e=t.min.seconds;e<this.SECONDS;e++){var r=e;a.push(r)}else if("max"==e)for(let e=0;e<=t.max.seconds;e++){var n=e;a.push(n)}else if("limit"==e)for(let e=t.min.seconds;e<=t.max.seconds;e++){var s=e;a.push(s)}else for(let e=0;e<this.SECONDS;e++){var i=e;a.push(i)}return a},dealIdx(t,a,e){let r=0;"day"==e&&(a-=1);for(let e=0;e<t.length;e++)e==a&&(r=e);return r},handleMask(){this.data.isCloseMask&&(this.setData({visible:!1}),this.triggerEvent("datetime_close",{type:"close"}))},handleCancel(){this.setData({visible:!1}),this.triggerEvent("datetime_close",{type:"cancel"})},handleConfirm(){var{years:e=[],months:t=[],days:a=[],hours:r=[],minutes:n=[],seconds:s=[],showYear:i,showHour:o,showMinute:u,showSeconds:h,currentYearIndex:l,currentMonthIndex:d,currentDayIndex:m,currentHourIndex:p,currentMinuteIndex:v,currentSecondsIndex:x}=this.data,c=[],y=[],e=(i&&(i=e[l])&&c.push(i),t[d]),l=(e&&c.push(e=e<10?"0"+e:e),a[m]);l&&c.push(l=l<10?"0"+l:l),o&&(i=r[p],y.push(i=i<10?"0"+i:i)),u&&(t=n[v],y.push(t=t<10?"0"+t:t)),h&&(d=s[x],y.push(d=d<10?"0"+d:d));let f=c.join("-");y.length&&(f=f+" "+y.join(":")),this.setData({visible:!1}),this.triggerEvent("datetime_confirm",{value:f})}}});